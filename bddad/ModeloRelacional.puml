@startuml
!define primary_key(x) <b><color:#b8861b><&key></color> x</b>
!define foreign_key(x) <color:#aaaaaa><&key></color> x
!define column(x) <color:#efefef><&media-record></color> x
!define table(x) entity x << (T, white) >>

' Zero or One	|o--
' Exactly One	||--
' Zero or Many	}o--
' One or Many	}|--

' Entidades com atributos proprios
table( ZonaGeografica ) {
    primary_key( codZonaGeografica ): INTEGER
    column( designacaoZonaGeografica ): VARCHAR
}

table( EstacaoMeteorologica ) {
    primary_key( codEstacaoMeteorologica ): INTEGER
    foreign_key( codZonaGeografica ): INTEGER
}

table( Sensor ) {
    primary_key( IdSensor ): INTEGER
    foreign_key(codTipoSensor): VARCHAR
    foreign_key( codEstacaoMeteorologica ): INTEGER
    column( valorReferencia ): INTEGER
}

table( TipoSensor ) {
    primary_key( codTipoSensor ): VARCHAR
}

table( Leitura ) {
    primary_key( codLeitura ): INTEGER
    foreign_key( idSensor ): INTEGER
    column( hora ): INTEGER
    column( data ): DATE
    column( minuto ): INTEGER
    column( valorLido ): INTEGER
}

table( FatoresProducao ) {
    primary_key( codFatorProducao ): INTEGER
    column( tipoFatorProducao ): VARCHAR
    column( preco/kg ): FLOAT
    column( nomeComercial ): VARCHAR
    column( formulacao ): VARCHAR
    column( fichaTecnica ): BLOB
}

table( Restricao ) {
    foreign_key(primary_key( codZonaGeografica )): INTEGER
    foreign_key(primary_key( codZonaGeografica )): INTEGER
    column( dataInicio ): DATE
    column( dataFim ): DATE
}

table( AplicacaoFatorProducao ) {
    foreign_key(primary_key( codOperacao )): INTEGER
    foreign_key(primary_key( codFatorProducao )): INTEGER
    foreign_key(primary_key( codSetorAgricola )): INTEGER
    foreign_key(primary_key( codCultura )): INTEGER
    column( qtFatorProducao ): INTEGER
}

table( SetorAgricola ) {
    primary_key( codSetorAgricola ): INTEGER
    column( designacaoSetorAgricola ): VARCHAR
    column( areaSetorAgricola ): INTEGER
}

table( Operacao ) {
    primary_key( codOperacao ): INTEGER
    foreign_key( anoPlanoAnual ): INTEGER
    foreign_key( codCalendarioOperacoes ): INTEGER
    column( dataPrevistaPlano ): DATE
    column( dataOperacao ): DATE
    column( formaAplicacao ): VARCHAR
    column( estadoOperacao ): VARCHAR
}

table( Cultura ) {
    primary_key( codCultura ): INTEGER
    column( designacaoCultura ): VARCHAR
    column( tipoCultura ): VARCHAR
    column( objetivoCultura ): VARCHAR
    column( tempoCrescimento ): INTEGER
}

table( SetorAgricola_Cultura ) {
    foreign_key(primary_key( codSetorAgricola )): INTEGER
    foreign_key(primary_key( codCultura )): INTEGER
    column( dataPlantacao ): DATE
}

table( PlanoAnual ) {
    primary_key( anoPlanoAnual ): INTEGER
}

table( CalendarioOperacoes ) {
    primary_key( codCalendarioOperacoes ): INTEGER
    column( anoCalendarioOperacoes ): INTEGER

}

table( Rega ) {
    primary_key( codRega ): INTEGER
    foreign_key( codOperacao ): INTEGER
    column( tempoRega ): INTEGER
}

table( AplicacaoRega ){
     foreign_key(primary_key( codRega )): INTEGER
     foreign_key(primary_key( codCultura )): INTEGER
     foreign_key(primary_key( codSetorAgricola )): INTEGER
     column( tipoRega ): VARCHAR
}

table( PlanoRega ) {
   foreign_key(primary_key( anoPlanoAnual )): INTEGER
   foreign_key( primary_key( codSetor )): INTEGER
   foreign_key(primary_key( codCultura )): INTEGER
   foreign_key(primary_key( codRega )): INTEGER
}

table( PlanoAnual_SetorAgricola ){
    foreign_key(primary_key( anoPlanoAnual )): INTEGER
    foreign_key( primary_key( codSetor )): INTEGER
    column( ordemRega ): INTEGER
    column( periodicidadeRegaSetor ): VARCHAR
}

table( Cultura_Rega ){
    foreign_key(primary_key( codCultura )): INTEGER
    foreign_key(primary_key( codRega )): INTEGER
    column( tipoDistribuicao ): VARCHAR
}

table( Colheita ) {
    primary_key( codColheita ): INTEGER
    column( anoColheita ): INTEGER
}

table( SetorAgricola_Colheita_Cultura ) {
    foreign_key(primary_key( codSetorAgricola )): INTEGER
    foreign_key(primary_key( codColheita )): INTEGER
    foreign_key(primary_key( codCultura )): INTEGER
    column( valorSetor ): FLOAT
}

table( Produto ) {
    primary_key( codProduto ): INTEGER
    foreign_key( codCultura ): INTEGER
    foreign_key( codColheita ): INTEGER
    column( preco/kg ): FLOAT
    column( stock/kg ): FLOAT
    column( designacao ): VARCHAR
}

table( Colheita_Cultura ){
    foreign_key(primary_key( codColheita )): INTEGER
    foreign_key(primary_key( codCultura )): INTEGER
    column( valorTotal ): FLOAT
}

table( Pedido_Produto ) {
    primary_key( codPedidoProduto ): INTEGER
    foreign_key( codPedido ): INTEGER
    foreign_key( codProduto ): INTEGER
    column( quantidadeProduto ): FLOAT
    column( precoPedido ): FLOAT
}

table( Pedido ) {
    primary_key( codPedido ): INTEGER
    foreign_key( codInterno ): INTEGER
    column( valorTotal ): FLOAT
    column( dataPedido ): DATE
    column( dataVencimento ): DATE
}

table( Entrega ) {
    primary_key( codEntrega ): INTEGER
    foreign_key( codMorada ): INTEGER
    column( dataEntrega ): DATE
}

table( Incidente ) {
    primary_key( codIncidente ): INTEGER
    foreign_key( codPedido ): INTEGER
    foreign_key( codInterno ): INTEGER
    column( dataOcorrencia ): DATE
}

table( Cliente ) {
    primary_key( codInterno ): INTEGER
    column( tipo ): VARCHAR
    column( nome ): VARCHAR
    column( emailCliente ): VARCHAR
    column( plafond ): INTEGER
    column( nrFiscal ): INTEGER
    column( moradaEntrega ): VARCHAR
    column( moradaCorrespondencia ): VARCHAR
}

table( MoradaEntrega ) {
    foreign_key(primary_key( codInterno )): INTEGER
    foreign_key( primary_key( codMorada )): INTEGER
}

table( MoradaCorrespondencia ) {
    foreign_key(primary_key( codInterno )): INTEGER
    foreign_key( primary_key( codMorada )): INTEGER
}

table( Morada ) {
    primary_key( codMorada ): INTEGER
    column( rua ): VARCHAR
    column( nrEdificio ): INTEGER
    column( andar ): INTEGER
    column( porta ): VARCHAR
    column( codPostal ): VARCHAR
    column( localidade ): VARCHAR
    column( pais ): VARCHAR
}

table( Nivel ) {
    primary_key( codNivel ): INTEGER
    column( designacaoNivel ): VARCHAR
}

table( Cliente_nivel ) {
    primary_key( codClienteNivel ): INTEGER
    foreign_key( codInterno ): INTEGER
    foreign_key( codNivel ): INTEGER
    column( dataAtribuicao ): DATE
}

table( Pagamento ) {
    primary_key( codPagamento ): INTEGER
    column( dataPagamento ): DATE
}

table( Pedido_Pagamento_Entrega ) {
    foreign_key( primary_key( codPedido )): INTEGER
    foreign_key( primary_key( codPagamento )): INTEGER
    foreign_key( primary_key( codEntrega )): INTEGER
    column( estadoAtual ): VARCHAR
}

table( InstalacaoAgricola ) {
    primary_key( codInstalacaoAgricola ): INTEGER
    column( designacao ): VARCHAR
}

table( Edificio ) {
    primary_key( codEdificio ): INTEGER
    column( tipoEdificio ): VARCHAR
}

' cardinalidades
Cliente ||--o{ Incidente
Cliente ||--o{ Pedido
InstalacaoAgricola ||--|{ Edificio
Cliente ||--|{ Cliente_nivel
Cliente_nivel }|--|| Nivel
InstalacaoAgricola ||--|{ SetorAgricola
SetorAgricola ||--|| Colheita
Cultura ||--|{ SetorAgricola_Cultura
SetorAgricola_Cultura }|--|| SetorAgricola
Pedido ||--|{ Pedido_Produto
Pedido_Produto }|--|| Produto
EstacaoMeteorologica ||--|| ZonaGeografica
EstacaoMeteorologica ||--|{ Sensor
TipoSensor ||--|{ Sensor
Sensor ||--|{ Leitura
Pedido ||--o| Incidente
Morada ||--o{ Entrega
Pedido ||--|| Pedido_Pagamento_Entrega
Pagamento |o--|| Pedido_Pagamento_Entrega
Entrega |o--|| Pedido_Pagamento_Entrega
Produto }|--|| Cultura
Operacao ||--|| Rega
CalendarioOperacoes ||--|{ Operacao
FatoresProducao ||--o{ Restricao
Restricao }o--|| ZonaGeografica
Incidente ||--|| Pagamento
SetorAgricola }|--|| ZonaGeografica
PlanoAnual ||--|{ Operacao
FatoresProducao ||--|| AplicacaoFatorProducao
Cultura ||--|| AplicacaoFatorProducao
Operacao ||--|| AplicacaoFatorProducao
SetorAgricola ||--|| AplicacaoFatorProducao
Morada ||--|| MoradaEntrega
Cliente ||--|| MoradaEntrega
Morada ||--|| MoradaCorrespondencia
Cliente ||--|| MoradaCorrespondencia
AplicacaoRega ||--|| Cultura
AplicacaoRega ||--|| SetorAgricola
AplicacaoRega ||--|| Rega
PlanoAnual ||--|{ PlanoAnual_SetorAgricola
SetorAgricola ||--|{ PlanoAnual_SetorAgricola
Cultura ||--|| Cultura_Rega
Rega ||--|| Cultura_Rega
PlanoRega ||--|{ Cultura_Rega
PlanoRega ||--|{ PlanoAnual_SetorAgricola

SetorAgricola_Colheita_Cultura ||--|| SetorAgricola
Colheita_Cultura ||--|| Colheita
Colheita_Cultura ||--|| Cultura
Colheita_Cultura ||--|{ SetorAgricola_Colheita_Cultura
Produto }|--|| Colheita_Cultura
@enduml